# 01. 코드 품질

### 목차

- 코드 품질이 중요한 이유
- 고품질의 코드의 4가지 목표
- 고품질 코드 작성을 위한 6가지 전략
- 고품질 코드작성이 시간, 노력을 절약할 수 있는 이유

---

## 고품질 코드

- 좀 더 신뢰할 수 있고, 유지보수가 쉽고, 버그가 적은 소프트웨어를 생산한다.
- 요구사항을 충족할 가능성이 최대한 높아진다.
- 좋은 소프트웨어를 만들기 위한 유일조건은 아니지만, 중요한 조건 중 하나

## 코드가 소프트웨어가 되는 과정 (개발 및 배포 프로세스)

### 용어

- 코드베이스 (codebase)
    - 소프트웨어를 빌드할 수 있는 코드가 저장된 저장소 (repository)
    - git, 서브버전, 퍼포스(perforce) 등과 같은 형상 관리 시스템에 의해 관리됨
- 코드 제출
    - 코드 커밋, merge a Pull Request 라고도 불림
    - 코드 베이스를 로컬에 복사하고 코드를 변경한 후, 변경한 사항을 메인 코드베이스에 제출
- code review
    - 변경 내용을 다른 엔지니어가 검토
- pre-submit check
    - pre-merge hook, pre-merge check, pre-commit check 이라고도 함
    - 테스트가 실패하거나 컴파일 되지 않는 경우 병합되지 않도록 차단
- 배포 (release)
    - 코드베이스의 스냅숏을 기반으로 빌드됨
    - 품질 보증 검사 후 실제 실행 환경에 배포
    - `배포 브랜치 만들기` 문구를 자주 사용
- 프로덕션 (production)
    - 소프트웨어가 서버나 시스템에 배포될 때, 테스트와 같은 내부가 아닌 **실제 서비스되는 환경**

### 작업 절차

- 코드베이스를 로컬로 복사, 코드 변경 작업
- 작업 이후 병합 요청→ 코드 검토 요청
- 다른 개발자가 코드 검토, 변경 제안
- 작성자, 검토자 모두 동의 → 코드베이스에 코드 병합
- 코드베이스를 기반으로 주기적으로 배포 (주기는 팀바팀~)
- 테스트 실패 또는 컴파일 안되면 병합/배포를 막음

## 코드 품질의 목표

- 결국에는 고품질의 소프트웨어를 만들기 위해서죵

1. 작동해야 한다
    - 요구 사항을 파악하고, 문제 해결을 위해 코드 작성
        - 기능 구현, 버그 수정, 작업 수행 등
    - 1번째 목표는 **작성된 목적대로 동작하는 것**

2. 작동이 멈추면 안 된다
    - 당장 돌아가는 것 뿐만 아니라, 변화하는 환경과 요구 사항에도 불구하고 계속 작동하는 코드

3. 변화하는 요구 사항에 적응해야 한다
    - 요구 사항이 어떻게 변화할지 정확히 알지는 못하지만, **적응성 높은 코드**를 작성해야 한다.

4. 이미 존재하는 기능을 중복 구현해서는 안 된다
    - 이미 구현된 코드를 재사용할 때의 장점
        - 시간, 노력 절약
        - 버그 가능성 감소
        - 기존 전문지식 활용
            - 기존 코드 작성자는 전문가. 그만큼 향후 업데이트도 빨리 해줌!
        - 코드 이해 용이

## 코드 품질의 핵심 요소

1. 읽기 쉬워야 한다
    - 다른 개발자가 코드를 이해하는 데 시간이 많이 소요되고, 잘못 이해하거나 세부 사항을 놓치게 된다면,
        
        버그를 발견할 가능성이 작고, 코드 수정 과정에서 새로운 버그가 발생할 가능성이 높다.
        
    - 올바른 추상화 계층 정의가 가독성에 도움이 된다.
2. 예측이 가능해야 한다
    - 이름, 데이터 유형, 일반적인 관행과 같은 단서를 사용해 코드가 입력값으로 무엇을 예상하는지, 코드가 무슨 일을 하는지, 무엇을 반환하는지에 대한 정신 모델을 구축한다.
    - 이와 어긋나는 일이 코드에 일어나면, 아무도 모르게 버그가 코드 내로 유입되는 일이 증가한다.
    - 예상과 벗어나는 일이 수행되면, 나중에 혹여 프로그램이 잘못된 상태에 놓이거나 이상한 값이 반환되어 심각한 상황이 초래될 수도 있다.
3. 오용하기 어렵도록 만들어라
    - HDMI 소켓과 전원 소켓이 다르게 생긴 이유는 ~?
    - 작성한 코드가 호출될 때, 만일 잘못 사용된다면 중요한 일이 수행되지 않거나, 이상하게 동작하지만 눈에 띄지 않을 수도 있다.
    - 코드가 오용하기 어렵거나 불가능하다면 코드가 **계속해서 잘** 작동할 가능성이 극대화된다.
4. 모듈화하라
    - 모듈화: 개체나 시스템의 구성 요소가 독립적으로 교환되거나 교체될 수 있음을 의미한다.
    - 변화하는 요구 사항에 더 쉽게 적응할 수 있는 코드를 작성하는 데 도움이 된다.
    - 기능이 관리 가능한 단위로 분리되고, 기능 단위 간 상호작용이 잘 정의되고 문서화되므로, 일반적으로 이해하기 쉽고 추론하기 쉬운 코드가 된다.
5. 재사용 가능하고 일반화할 수 있게 작성하라
    - 재사용성: 어떤 문제를 해결하기 위한 무언가가 여러 가지 다른 상황에서도 사용될 수 있음을 의미한다.
        - e.g.) 같은 문제 (드릴로 구멍을 뚫어야 함), 다른 상황 (벽 뚫기, 바닥 뚫기)
    - 일반화성: 개념적으로는 유사하지만 서로 미묘하게 다른 문제들을 해결할 수 있음을 의미한다.
        - e.g.) 핸드 드릴은 구멍도 뚫을 수 있고, 나사를 박을 수도 있음
    - 코드베이스에서 코드 라인이 적을수록 좋다.
    - 재사용 가능하게 일반화하면 그 코드를 여러 상황에서 사용하고, 여러 문제를 해결할 수 있어, 시간과 노력을 절약하고 더 신뢰할 수 있는 코드가 된다.
6. 테스트가 용이한 코드를 작성하고, 제대로 테스트하라
    - 테스트는 아래의 두 가지 사항에 대한 방어 수단이 된다.
        - 버그 혹은 제대로 동작하지 않는 기능을 갖는 코드가 코드베이스에 병합되지 않도록 방지
        - 버그 혹은 제대로 동작하지 않는 기능을 갖는 코드가 배포되지 않도록 막고 서비스 환경에서 실행되지 않도록 보장
    - 테스트 종류
    	+ 단위 테스트: 개별 함수나 클래스와 같은 작은 단위의 코드 테스트
    	+ 통합 테스트: 여러 구성 요소, 모듈, 하위 시스템으로 구성되고, 이러한 구성 요소와 하위 시스템을 함께 연결하는 과정이 통합
    	+ 종단간 테스트: 처음부터 끝까지 전체 소프트웨어 시스템에서 작동의 흐름 (워크플로우)을 테스트
	+ 테스트 용이성: 테스트대상이 되는 실제 코드가 테스트하기 얼마나 적합한지를 나타낸다
    	+ 모듈화된 코드일수록 테스트 용이성이 더 좋음
    	
## 고품질 코드 작성은 일정을 지연시키는가?

- 단기적으로는 그렇다
- 중장기적으로는 시간을 단축해준다

---

## 요약

- 좋은 소프트웨어를 만들려면 고품질 코드를 작성해야 한다
- 실제 서비스 환경에서 실행되는 소프트웨어가 되기 전에 일반적으로 여러 단계의 검사와 테스트를 통과해야 한다
- 버그나 제대로 동작하지 않는 기능이 사용자에게 제공되거나 비즈니스에 중요한 시스템에서 실행되는 것을 검사를 통해 방지한다
- 테스트는 코드를 작성하는 모든 단계에서 고려해야 한다 (코드를 다 작성하고 난 후 X)
- 고품질 코드를 작성하면 처음에는 시간이 오래 걸리지만, 중장기적으로는 개발 시간이 단축되는 경우가 많다   
