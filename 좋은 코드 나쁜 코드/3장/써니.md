# 3장 다른 개발자와 코드 계약

## 3.1 자신의 코드와 다른 개발자의 코드
자신이 작성한 코드는 다른 개발자들이 작성한 코드에 의존하고, 다른 개발자들 역시 더 높은 수준의 문제를 해결하기 위해 우리가 작성한 코드에 의존 한다.
또한 여러 가지 다른 기능을 위해 작성한 코드가 재사용 되고 있음을 알 수 있다.

요구 사항은 항상 변한다. 우선 순위가 변경되고, 새로운 기능이 추가되어야 하며, 시스템은 때로 새로운 기술 환경으로 옮겨져야 한다. 이는 코드와 소프트웨어도 항상 변한다는 것을 의미한다.

고품질 코드를 작성할 때 가장 중요한 고려사항 중 하나는 다른 개발자가 변경하거나 코드와 상호작용할 때 발생할 수 있는 문제는 없는지, 또 발생한다면 그 문제를 어떻게 완화할 수 있을지를 이해하고 선제적으로 조치하는 것이다. 

코드 작성 시 고려하면 유용한 3가지
+ 자신에게 명백하다고 해서 다른 사람에게도 명백한 것은 아니다.
+ 다른 개발자는 무의식 중에 여러분의 코드를 망가뜨릴 수 있다.
+ 시간이 지남에따라 자신의 코드를 기억하지 못한다.

### 3.1.1 자신에게 분명하다고 해서 다른 사람에게도 분명한 것은 아니다
다른 개발자가 내가 작성한 코드와 상호작용하거나 내 코드를 변경하거나 내 코드가 의존하고 있는 코드를 변경해야 할 수 있다. 다른 개발자는 그 문제를 이해하고 어떻게 해결할지에 대해 생각할 수 있는 시간을 아직 충분히 갖지 못한 상태다. 코를 작성할 당시에 너무도 분명해 보였던 것들이 다ㄴ 개발자에게는 분명하지 않을 것이다.

### 3.1.2 다른 개발자는 무의식중에 여러분의 코드를 망가뜨릴 수 있다.
내가 작성한 코드는 독립적으로 전재하지 않는다. 다른 코드에 의존할 것이고, 그 코드는 또다시 더 많은 다른 코드에 의존할 것이다. 본인 코드는 본인에게 가장 중요할지 모르지만 회사의 다른 개발자들은 그것에 대해 잘 알지 못할 것이고, 그 코가 왜 존재하는지 무슨 일을 수행하는지에 대한 사전 지식을 갖고 있지 않을 수 있다. 다른 개발자가 의도치 않게 잘 실행되던 코드를 작동하지 않게 하거나 오용하는 방식으로 코드를 추가하거나 수정할 가능성이 크다.

### 3.1.3 시간이 지나면 자신의 코드를 기억하지 못한다.
--> 젤 공감 가는 챕터
코드의 세부 사항이 지금은 마음속에서 너무나 신선하고 또한 가장 중요한 것으로 여겨지기 때문에 그것들을 결코 잊을 수 없으리라 생ㅏㄱ하지만 시간이 지나면 그것들이 더 이상 신선하지 않고 잊히기 시작한다. 자신의 코드가 이해하기 쉬어야 하고, 잘 작동하던 코드에 버그가 발생하는 것이 어려워야 한다. 이는 다른 사람에게도, 미래의 자신에게도 유익한 일이다.


## 3.2 여러분이 작성한 코드의 사용법을 다른 사람들은 어떻게 아는가?
다른 사람의 코드를 어떻게 사용하는지 다음과 같은 사항을 이해하고 파악해야 한다.
+ 여러 가지 상황에서 어떤 함수를 호출해야 하는지
+ 클래스가 무엇을 나타내는지 그리고 언제 사용되어야 하는지
+ 어떤 값을 인수로 사용해야 하는지
+ 어떤 값을 반환하는지

이로인해 다른 개발자가 할 수 있는 일은 다음과 같다.
+ 함수, 클래스, 열거형 등의 이름을 살펴본다.
+ 함수와 생성자의 매개변수 유형 또는 반환값의 유형 같은 데이터 유형을 살펴본다.
+ 함수/클래스 수준의 문서나 주석문을 읽어본다.
+ 직접 와서 묻거나 채팅/이메일을 통해 문의한다. --> ㅋㅋㅋㅋ
+ 여러분이 작성한 함수와 클래스의 자세한 구현 코드를 읽는다.

이때, 이름과 데이터 유형을 확인하는 것이 문서를 읽는 것보다 더 신뢰할 만하다.
> 이름을 잘 짓는 것이 왜 중요한지 알 수 있다.

### 3.2.1 이름 확인
이름을 살펴보는 것은 개발자들이 새로운 코드의 사용 방법을 알아내기 위해 실제로 사용하는 주된 방법 중 하나다.
패키지, 클래스, 함수의 이름을 책의 목차라고 할 수 있다. 이 이름들을 살펴보는 것은 하위 문제를 해결할 코드를 찾기 위한 편리하고 빠른 방법이다.
따라서, 자신의 코드를 다른 개발자가 어떻게 사용해야 하는지에 대해 가장 잘 전달할 수 있는 방법 중 하나는 이름을 잘 짓는 것이다.

### 3.2.2 데이터 유형 확인
제대로만 한다면 데이터 유형을 확인하는 것 역시 다른 개발자로 하여금 자신의 코드를 올바르게 사용하도록 하기 위한 매우 신뢰할 만한 방법이다. 유형 시스템을 사용하는 언어로 코드를 작성하는 것은 다른 개발자가 코드를 오용하거나 오작동 할 수 없도록 하기 위한 좋은 방법 중하나다.

### 3.2.3 문서 읽기
코드를 사용하는 방법에 관한 문서는 두 가지 이상의 형태로 존재할 수 있으며 다음을 포함한다.
+ 함수 및 클래스 수준의 비공식적인 주석문
+ 자바독(JavaDoc)과 같은 좀 더 공식적인 코드 내 문서
+ 외부 문서(README.md, 웹 페이지, 지침 문서 등)

이 모든 것이 매우 유용하지만 다른 개발자가 코드를 올바르게 사용하도록 하기 위한 방법으로 어느 정도까지만 신뢰할 수 있다.

+ 다른 개발자가 이 문서들을 읽을 것이라는 보장이 없다. --> 실제로 읽지 않을 때가 많다.
+ 읽더라도 잘못 해석할 수 있다. 익숙하지 않은 용어를 사용할 수 있고, 잘못된 가정을 바탕으로 문서를 작성할 수도 있다.
+ 문서의 업데이트가 제대로 안 될 수 있다.

### 3.2.4 직접 물어보기
> 솔직히 이것만큼 직빵인게 없는듯 하다. 코드 주인의 시간을 할애하다보니 비용 발생이 너무 심각하다 생각한다.
책에서는 다음과 같은 이유로 코드 사용법을 설명하기엔 신뢰하기 어려운 방법이라 한다.

+ 코드를 많이 작성할수록 질문에 답하는 데 더 많은 시간을 써야 할 것이다.
+ 코드 작성자가 2주간 휴가를 간다면 코드에 대해 물어볼 사람이 없다.
+ 1년이 지나면 자기 자신도 그 코드를 기억하지 못한다.
+ 코드를 작성한 사람이 회사를 떠날 수도 있다.

### 3.2.5 코드를 살펴보는 것
코드가 수천, 수만 줄이라면 이 코드를 전부 살펴보는 것은 크나큰 비용 발생이고, 이를 살펴보고 이해하는 데도 큰 시간이 들 것이다.
추상화 계층을 만드는 데 있어 요점은 개발자가 한 번에 몇 가지 개념만 처리해야 하고, 그 문제가 어떻게 해결되었는지 정확히 알지 못하더라도 하위 문제에 대한 해결책을 사용할 수 있어야 한다는 것이다. 코드를 사용하는 방법을 알기 위해 개발자가 구현 세부 사항을 읽어야 한다면 이는 분명히 추상화 계층의 많은 이점을 부정하는 것이 된다.


## 3.3 코드 계약
**계약에 의한 프로그래밍(programming by contract)** 또는 **계약에 의한 디자인(design by contract)**라는 용어는 다른 사람들이 어떻게 코드를 사용할지, 그리고 코드가 무엇을 할 것으로 기대할 수 있는지에 대한 것이다. 이 철학에서는 서로 다른 코드 간의 상호작용을 마치 계약처럼 생각한다. 어떤 코드를 호출하는 코드는 특정 요건을 충족해야 하며 호출되는 코드는 원하는 값을 반환하거나 일부 상태를 수정한다. 모든 것이 이 계약에서 정의되기 때문에 분명하지 않은 것이 없고 예상과 다르게 실행되는 것도 없다.

코드 계약에 대한 용어 범주 3가지
+ 선결조건(precondition)
    > 코드를 호출하기 전에 사실이어야 하는 것, Ex_시스템이 어떤 상태에 있어야 하는지, 코드에 어떤 입력을 공급해야 하는지와 같은 사항
+ 사후 조건(postcondition)
    >  코드가 호출된 후에 사실이어야 하는 것, Ex_시스템이 새로운 상태에 놓인다든지 반환되는 값과 같은 사항
+ 불변 사항(invariant)
    > 코드가 호출되기 전과 후에 시스템 상태를 비교해서 변경되지 않아야 하는 사항

개발자가 계약의 일부 혹은 모든 조건을 알지 못하면 코드 계약에 문제가 발생한다. 코드를 작성할 때, 만들어지는 계약의 내용이 무엇일지 그리고 어떻게 하면 코드를 사용하는 사람이 계약을 파악하고 따라갈 수 있을지에 대해 생각하는 것이 중요하다.

### 3.3.1 계약의 세부 조항
코드에서 계약을 정의할 때 명확한 부분과 세부 조항이 있다.

+ 계약의 명확한 부분
    + 함수와 클래스 이름
        > 호출하는 쪽에서 이것을 모르면 코드를 사용할 수 없다.
    + 인자 유형
        > 호출하는 쪽에서 인자의 유형을 잘못 사용하면 코드는 컴파일조차 되지 않는다.
    + 반환 유형
        > 호출하는 쪽에서 함수의 반환 유형을 알아야 한다. 이 유형과 일치하지 않는 유형을 사용하면 코드는 컴파일되지 않는다.
    + 검사 예외(checked exception)
        > 호출하는 코드가 이것을 처리하지 않으면 코드는 컴파일되지 않는다.
+ 세부 조항
    + 주석문과 문서
        > 실제 계약의 세부 조항에 대해 그렇듯이 꼼꼼하게 모두 다 읽어봐야 하는 것임에도 실제로는 잘 읽지 않는다. 개발자는 이 사실을 실용적인 관점에서 봐야 한다.
    + 비검사 예외
        > 주석문에 이 예외가 나열되어 있다면 이것은 세부 조항이다. 어떤 때는 심지어 세부 조항에도 나와 있지 않을 수도 있다. 

코드 계약에서 조건을 명백하게 하는 것이 세부 조항을 사용하는 것보다 훨씬 낫다. 사람들은 세부 조항을 읽지 않는 경우가 매우 많으며, 읽더라도 대충 훑어보기 때문에 잘못 이해할 수 있다.

### 3.3.2 세부 조항에 너무 의존하지 말라
세부 조항이 너무 많으면 다른 개발자는 이 세부 조항을 모두 알아야 한다.
또, 올바른 순서로 이뤄지지 않는다면 이 클래스는 잘못된 상태에 놓인다.
--> 정적 팩토리 함수를 사용해 초기화가 완전히 이뤄진 인스턴스를 생성하도록 하자.


## 3.4 체크 및 어서션
컴파일러를 사용하여 코드 계약을 확인하는 것에 대한 대안으로 런타임 검사를 사용할 수 있다. 코드 계약 위반의 발견이 코드를 실행하는 동안 발생하는 문제에 대한 테스트에 의존하기 때문에 컴파일 타임 확인만큼 강력하진 않다. 이는 계약 위반을 논리적으로 불가능하게 만드는 컴파일 타임 확인과는 대조적이다.

### 3.4.1 체크
코드 계약 조건을 확인하기 위한 일반적인 방법으로 체크(check)를 사용하는 것이다.
이는 코드 계약이 준수되었는지(입력 매캐변수에 대한 제약 조건 또는 수행해야 할 설정에 대한 제약 등) 확인하기 위한 추가적인 로직이며, 준수되지 않을 경우 체크는 실패를 유발하는 오류를 생성하는데, 이 실패는 명백해서 놓치고 넘어가는 것이 불가능 하다.
> 체크는 신속한 실패와 밀접한 관련이 있다.

체크를 사용할 때 기대하는 것은 코드가 오용되면 고객에게 배포되거나 실제 프로덕션에서 서비스되기 전에 개발 단계나 테스트 단계에서 발견되고 수정되는 것이다. 

**퍼즈 테스트**
코드나 소프트웨어의 버그나 잘못된 설정을 드러낼 수 있는 입력값을 생성해 테스트를 수행하는 테스트의 한 종류다.
퍼즈 테스트를 사용하는 경우, 체크, 어서션을 함께 사용하면 잘못된 설정이나 버그를 발견할 가능성을 높이는 데 도움이 된다. 
> 오류나 예외 발생에 의존하며 이것만으로는 단순히 이상한 동작을 초래하는 미묘한 버그를 발견할 수 없기 때문

### 3.4.2 어서션
어서션(Assertion)은 코드 계약을 준수하도록 강제하기 위한 방법이라는 점에서 체크와 매우 유사하다.
코드가 개발 모드에서 컴파일 되거나 테스트가 실행될 때, 어서션은 체크와 거의 같은 방식으로 동작한다. 조건이 위반되면 오류가 명백하게 보이거나 예외가 발생한다. 어서션과 체크 사이의 주요 차이점은 배포를 위해 빌드할 때 어서션은 보통 컴파일에서 제외된다는 점이며, 이는 코드가 실제 서비스 환경에서 사용될 때 실패를 명백하게 보여주지 않는다는 것을 의미한다.

코드를 배포할 때 컴파일하지 않는 이유
+ 성능 향상
    > 조건이 위반되는지 확인하려면 CPU 사이클이 필요하다. 코드에서 어서션이 많으면 소프트웨어의 전반적인 성능이 눈에 띄게 저하될 수 있다.
+ 코드 오류 발생률을 낮춤
    > 이것이 유효한 동기인지 아닌지는 특정 응용 프로그램에 달려있다. 이로 인해 버그가 눈에 띄지 않을 가능성이 증가하지만 버그 발생 가능성 방지보다 고가용성이 더 중요한 시스템이라면 배포 시에 컴파일에서 제외하는 것은 적절한 절충이 될 수 있다.

## 요약
+ 코드베이스는 계속 변하고 일반적으로 여러 개발자에 의해 변경된다.
+ 다른 개발자가 어떻게 코드를 해석하고 오용할 수 있을지 생각해보고, 이러한 가능성을 최소화 하거나 오용이 불가능하게 만드는 방식으로 코드를 작성하는 것이 유용하다.
+ 코드를 작성할 때 일종의 코드 계약이 항상 만들어진다. 여기에 명백한 항목이나 세부 조항과 같은 내용이 포함될 수 있다.
+ 코드 계약의 세부조항은 다른 개발자가 계약을 준수하도록 하기 위한 방법이지만 신뢰할만한 방법은 아니다. 보통 더 나은 접근법은 명백한 항목으로 계약의 내용을 전달하는 것이다.
+ 일반적으로 컴파일러를 사용하여 계약을 확인하는 것이 가장 신뢰할 수 있는 방법이다. 이것이 가능하지 않을 때, 체크나 어서션을 사용하여 실행 시간에 계약을 확인할 수 있다.

